
## 🎨 一、界面总体架构（React Native + Expo）

前端采用「行程主页面 → 阶段切换 → 智能体面板」三层结构：

```
[HomePage] 我的行程卡片
   ↓
[TripDetailPage] 行程详情页
   ├── StageTabs：Pre / On / Post 三阶段切换
   │     ├── PreTripScreen（行前规划）
   │     ├── OnTripScreen（旅行中）
   │     └── PostTripScreen（回程后）
   └── FloatingChatButton：打开阶段智能体面板
```

所有阶段共用：

* ChatPanel（智能体对话窗，WebSocket 接口 `/ws/agent/{trip_id}/{stage}`）
* TaskList（任务清单）
* MapCard / Timeline（日程可视化）
* StageProgress（阶段状态展示）

---

## 🧭 二、各阶段界面设计与功能承载

### 1️⃣ Pre-Trip 行前阶段

核心目标：规划与准备。

**主要界面：**

| 模块               | 说明                                                            |
| ------------------ | --------------------------------------------------------------- |
| 🗺️ 行程规划卡    | 展示 LLM 生成的草案路线（每天分块显示，锚点景点卡片可展开详情） |
| 💰 预算比较区      | 酒店/航班候选卡片：地图 + 价格 + 评分 + “采纳方案”按钮        |
| 📋 准备清单        | 智能体生成的任务（签证、行李、预订），状态可切换                |
| 💬 AI 规划助手面板 | 聊天输入框 + 结构化回复渲染（cards、links、tasks）              |
| 🌦️ 天气与提示    | 根据目的地与时间显示天气、装备建议                              |

**智能体交互入口：**

* 顶部浮动按钮「生成行程方案」
* 聊天面板发送自然语言，如“帮我找性价比高的酒店”
* agent 输出结构化 JSON：`{plans:[], tasks:[], suggestions:[]}`

  → 由前端解析生成卡片与待办。

【来源 9†各阶段智能体设计方案†L1-L40】

---

### 2️⃣ On-Trip 在途阶段

核心目标：实时陪伴、导航与变更。

**主要界面：**

| 模块            | 说明                                               |
| --------------- | -------------------------------------------------- |
| 📅 当日日程视图 | Timeline + 当前时间指示，自动高亮正在进行项        |
| 📍 附近推荐卡   | 基于定位 + 智能体推荐的景点/餐饮（支持“换一批”） |
| 🚨 告警通知栏   | 航班延误、天气警报、路线调整提示（WS 实时推送）    |
| 🗺️ 离线地图页 | OsmAnd 式离线导航，支持“现在出发”倒计时          |
| 💬 AI 随行助手  | 聊天输入框 + 快捷按钮（附近餐厅、路线重排、翻译）  |

**智能体交互逻辑：**

* 调用 `weather_tool`, `map_tool`, `flight_tool`
* 返回 `{alerts, itinerary_deltas, nearby}`

  → 前端更新 UI 或弹出“采纳改动”确认框。

【来源 9†各阶段智能体设计方案†L60-L100】

---

### 3️⃣ Post-Trip 回程阶段

核心目标：总结、偏好抽取与资产沉淀。

**主要界面：**

| 模块              | 说明                                         |
| ----------------- | -------------------------------------------- |
| 🧾 旅行总结报告   | 智能体生成文字 + 图表（花费、路线、足迹）    |
| 📸 回忆相册       | 关联图片、票据文件（来自 MinIO 存储）        |
| 🏷️ 偏好标签展示 | “喜欢美食 / 讨厌早起”等 tag chips          |
| 💡 下次建议卡     | 智能体生成的改进建议                         |
| 💬 回顾助手       | 聊天窗口，用户可询问“总结一下我此行的亮点” |

**输出结构：**

`{summary, stats, tags, recommendations}`

前端将 summary 渲染为报告页，可导出 PDF 或分享卡片。

【来源 9†各阶段智能体设计方案†L100-L140】

---

## 🧩 三、界面与后端映射

| 前端组件         | 后端接口                                        | 数据表 / 模块                |
| ---------------- | ----------------------------------------------- | ---------------------------- |
| TripCard / List  | `GET /api/trips`                              | `trips`,`trip_stages`    |
| StageTabs        | `PATCH /api/trips/{id}/stage`                 | `trip_stages`              |
| ChatPanel        | `ws /api/ws/agent/{trip_id}/{stage}`          | `conversations`            |
| TaskList         | `GET /api/trips/{id}/tasks`                   | `tasks`                    |
| MapCard / Nearby | `providers/gaode_service`,`weather_service` | 外部 API 封装                |
| ReportPage       | `GET /api/trip/{id}/report`                   | `user_tags`,`kb_entries` |

【来源 10†后端设计方案†L290-L330】

---

## 🧠 四、设计要点与交互原则

1. **阶段独立 + 连贯记忆** ：三阶段共用用户 Trip 上下文，智能体 memory 在 Redis 短期存储、Qdrant 长期存储。
2. **结构化输出直渲染** ：Agent 返回的 JSON 由前端解析为卡片而非纯文本。
3. **离线优先** ：在途阶段关键数据缓存 AsyncStorage 并支持 Offline 模式。
4. **确认式操作** ：所有修改行程的智能体建议需用户点击确认后写回数据库。
5. **安全与隐私** ：定位授权提示、聊天数据加密传输 (HTTPS + JWT)。

【来源 9†各阶段智能体设计方案†L160-L200】

---

## 🪄 五、可扩展交互（增强功能）

| 模块                | 功能示例                                         |
| ------------------- | ------------------------------------------------ |
| “AI 一键行程生成” | 综合 Pre-Trip 阶段多轮对话生成完整 itinerary     |
| “现在出发”提醒    | 结合 航班 + 路况 API 实时倒计时                  |
| “旅行统计卡片”    | Post-Trip 自动汇总费用、里程、偏好               |
| “协同规划”        | 多人共用同一 Trip 的 Pre-Trip 阶段，实时更新草案 |
| “语音交互”        | 接入 Expo Speech/Whisper 实现语音输入/播报       |

---

是否希望我进一步输出一份

👉 **「三阶段前端界面原型图（含组件结构与状态流）」** ？

我可以生成 Figma 风格或 React Native 组件树示意图，便于前端实现与论文展示。
